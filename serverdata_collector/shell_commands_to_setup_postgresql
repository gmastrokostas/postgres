yum update -y; reboot
yum update -y
yum clean all
hostnamectl set-hostname database-centos8
adduser seeker
passwd  seeker
yum install python3-psycopg2
sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
sudo dnf -y module disable postgresql
sudo dnf install -y postgresql14-server
sudo dnf install -y postgresql14-contrib
reboot
yum install epel-release
yum update
yum install ansible* ansible-*
sudo /usr/pgsql-14/bin/postgresql-14-setup initdb
sudo systemctl enable --now  postgresql-14
su - postgres
sudo systemctl disable --now firewalld
setfacl -R -m u:postgres:rwx /home/seeker/project_scripts/servers/
setfacl -R -m g:postgres:rwx /home/seeker/project_scripts/servers/
setfacl -R -m u:postgres:x /home/seeker
setfacl -R -m u:postgres:xrx /home/seeker/project_scripts/
setfacl -R -m u:postgres:xrw /home/seeker/project_scripts/
setfacl -R -m u:postgres:xr /home/seeker
setfacl -R -m u:postgres:xr /home/seeker/project_scripts/
setfacl -R -m u:postgres:xrw  /home/seeker/project_scripts/servers/
#####AS POSTGRES LINUX USER
ALTER USER postgres PASSWORD 'zxc123';
create role seeker with login password 'zxc123';
create database serverdata;
alter role seeker superuser;

##Now you can create the tables
psql -d serverdata
#########################################
-- Table: pico_schema.servers

-- DROP TABLE IF EXISTS pico_schema.servers;

CREATE TABLE IF NOT EXISTS pico_schema.servers
(
    hostname text COLLATE pg_catalog."default" NOT NULL,
    date_cpt text COLLATE pg_catalog."default",
    time_cpt text COLLATE pg_catalog."default",
    os text COLLATE pg_catalog."default",
    osrel text COLLATE pg_catalog."default",
    total_m text COLLATE pg_catalog."default",
    cpubrand text COLLATE pg_catalog."default",
    cores text COLLATE pg_catalog."default",
    arch text COLLATE pg_catalog."default",
    server_brand text COLLATE pg_catalog."default",
    virt_role text COLLATE pg_catalog."default",
    virt_type text COLLATE pg_catalog."default",
    uptime text COLLATE pg_catalog."default",
    CONSTRAINT pk_servers_hostname PRIMARY KEY (hostname)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS pico_schema.servers
    OWNER to seeker;
----------------------

-- Table: pico_schema.rpm_packages

-- DROP TABLE IF EXISTS pico_schema.rpm_packages;

CREATE TABLE IF NOT EXISTS pico_schema.rpm_packages
(
    hostname text COLLATE pg_catalog."default",
    date_cpt text COLLATE pg_catalog."default",
    time_cpt text COLLATE pg_catalog."default",
    rpm_name text COLLATE pg_catalog."default",
    rpm_version text COLLATE pg_catalog."default",
    rpm_release text COLLATE pg_catalog."default",
    CONSTRAINT fk_rpms_pckgs_hostname FOREIGN KEY (hostname)
        REFERENCES pico_schema.servers (hostname) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS pico_schema.rpm_packages
    OWNER to seeker;





